# è”é‚¦å­¦ä¹ å®éªŒé¡¹ç›® - æ¶ˆèç ”ç©¶ç‰ˆ

> è¿™æ˜¯æˆ‘åœ¨æœºå™¨å­¦ä¹ è¯¾ç¨‹å¤§ä½œä¸šä¸­å®ç°çš„è”é‚¦å­¦ä¹ å®éªŒé¡¹ç›®ã€‚ä½œä¸ºä¸€åå­¦ç”Ÿï¼Œæˆ‘åœ¨è¿™ä¸ªé¡¹ç›®ä¸­å°è¯•äº†ä¸åŒçš„è”é‚¦å­¦ä¹ æ–¹æ³•ï¼ŒåŒ…æ‹¬åŸºçº¿å¯¹æ¯”å®éªŒã€ç»å…¸è”é‚¦å­¦ä¹ å’Œæ®‹å·®è”é‚¦å­¦ä¹ çš„å®ç°ã€‚

## ğŸ“š é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®å®ç°äº†ä¸‰ç§ä¸åŒçš„æœºå™¨å­¦ä¹ è®­ç»ƒæ–¹æ³•ï¼š

- **åŸºçº¿å®éªŒ (Baseline)**ï¼šé›†ä¸­å¼è®­ç»ƒï¼Œä½œä¸ºå¯¹æ¯”åŸºå‡†
- **è”é‚¦å­¦ä¹  (Federated Learning)**ï¼šç»å…¸çš„FedAvgç®—æ³•å®ç°  
- **æ®‹å·®è”é‚¦å­¦ä¹  (Residual Federated Learning)**ï¼šæˆ‘ä»¬æå‡ºçš„æ”¹è¿›æ–¹æ³•

é€šè¿‡å¯¹æ¯”è¿™ä¸‰ç§æ–¹æ³•åœ¨ä¸åŒæ•°æ®é›†ä¸Šçš„è¡¨ç°ï¼Œæ¢ç´¢è”é‚¦å­¦ä¹ çš„ä¼˜åŠ¿å’Œå±€é™æ€§ã€‚

## ğŸ—ï¸ é¡¹ç›®ç»“æ„

``` bash
Code_Ablation/
â”œâ”€â”€ ä¸»ç¨‹åºæ–‡ä»¶
â”‚   â”œâ”€â”€ baseline_main.py          # åŸºçº¿å®éªŒä¸»ç¨‹åº
â”‚   â”œâ”€â”€ federated_main.py         # è”é‚¦å­¦ä¹ ä¸»ç¨‹åº  
â”‚   â”œâ”€â”€ residual_main.py          # æ®‹å·®è”é‚¦å­¦ä¹ ä¸»ç¨‹åº
â”‚   â””â”€â”€ experiment_manager.py     # ç»Ÿä¸€å®éªŒç®¡ç†å™¨
â”‚
â”œâ”€â”€ æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ models.py                 # å…¼å®¹æ€§æ¨¡å‹é›†åˆ
â”‚   â”œâ”€â”€ models_mnist.py           # MNISTä¸“ç”¨æ¨¡å‹
â”‚   â”œâ”€â”€ models_cifar10.py         # CIFAR-10ä¸“ç”¨æ¨¡å‹
â”‚   â”œâ”€â”€ models_cifar100.py        # CIFAR-100ä¸“ç”¨æ¨¡å‹
â”‚   â””â”€â”€ model_factory.py          # æ¨¡å‹å·¥å‚ç±»
â”‚
â”œâ”€â”€ æ ¸å¿ƒç»„ä»¶
â”‚   â”œâ”€â”€ options.py                # å‘½ä»¤è¡Œå‚æ•°é…ç½®
â”‚   â”œâ”€â”€ utils.py                  # å·¥å…·å‡½æ•°å’Œæ•°æ®å¢å¼º
â”‚   â”œâ”€â”€ update.py                 # æœ¬åœ°æ›´æ–°å’Œæµ‹è¯•å‡½æ•°
â”‚   â”œâ”€â”€ sampling.py               # æ•°æ®é‡‡æ ·å’Œåˆ†å¸ƒæ¨¡æ‹Ÿ
â”‚   â””â”€â”€ residual_utils.py         # æ®‹å·®å­¦ä¹ ä¸“ç”¨å·¥å…·
â”‚
â”œâ”€â”€ è¾…åŠ©å·¥å…·
â”‚   â”œâ”€â”€ download.py               # æ•°æ®é›†ä¸‹è½½å·¥å…·
â”‚   â””â”€â”€ visualize_results.py      # å®éªŒç»“æœå¯è§†åŒ–
â”‚
â””â”€â”€ è¾“å‡ºç›®å½•
    â”œâ”€â”€ data/                     # æ•°æ®é›†å­˜å‚¨
    â”œâ”€â”€ logs/                     # è®­ç»ƒæ—¥å¿—
    â””â”€â”€ save/                     # ä¿å­˜çš„æ¨¡å‹å’Œç»“æœ
        â”œâ”€â”€ logs/                 # å®éªŒæ—¥å¿—è®°å½•
        â”œâ”€â”€ objects/              # åºåˆ—åŒ–å¯¹è±¡
        â””â”€â”€ plots/                # å®éªŒå›¾è¡¨
```

## ğŸš€ å¿«é€Ÿå¼€å§‹

### ç¯å¢ƒè¦æ±‚

- Python 3.6+
- PyTorch >= 1.0.0
- torchvision
- numpy
- matplotlib
- pandas
- tqdm
- tensorboardX

### å®‰è£…ä¾èµ–

```bash
pip install torch torchvision numpy matplotlib pandas tqdm tensorboardX
```

### ä½¿ç”¨ç»Ÿä¸€å®éªŒç®¡ç†å™¨ï¼ˆæ¨èï¼‰

```bash
# æŸ¥çœ‹å¸®åŠ©ä¿¡æ¯
python experiment_manager.py --help

# è¿è¡ŒMNISTåŸºçº¿å®éªŒ
python experiment_manager.py --dataset mnist --method baseline --model cnn --epochs 50

# è¿è¡ŒCIFAR-10è”é‚¦å­¦ä¹ å®éªŒ
python experiment_manager.py --dataset cifar --method federated --model resnet18 --epochs 100

# è¿è¡ŒCIFAR-100æ®‹å·®è”é‚¦å­¦ä¹ å®éªŒ
python experiment_manager.py --dataset cifar100 --method residual --model efficientnet --epochs 150
```

### å•ç‹¬è¿è¡Œå®éªŒ

#### 1. åŸºçº¿å®éªŒ

```bash
python baseline_main.py --dataset mnist --model cnn --epochs 50 --lr 0.01
python baseline_main.py --dataset cifar --model resnet18 --epochs 100 --lr 0.001
```

#### 2. è”é‚¦å­¦ä¹ å®éªŒ  

```bash
python federated_main.py --dataset mnist --model cnn --epochs 50 --num_users 100 --frac 0.1
python federated_main.py --dataset cifar --model resnet18 --epochs 100 --num_users 50 --frac 0.2
```

#### 3. æ®‹å·®è”é‚¦å­¦ä¹ å®éªŒ

```bash
python residual_main.py --dataset mnist --model cnn --epochs 50 --pretrain_epochs 10
python residual_main.py --dataset cifar100 --model efficientnet --epochs 150 --residual_type adaptive
```

## ğŸ“Š æ”¯æŒçš„æ•°æ®é›†å’Œæ¨¡å‹

### æ•°æ®é›†

- **MNIST**: æ‰‹å†™æ•°å­—è¯†åˆ« (28Ã—28ç°åº¦å›¾åƒ)
- **Fashion-MNIST**: æœè£…åˆ†ç±» (28Ã—28ç°åº¦å›¾åƒ)  
- **CIFAR-10**: è‡ªç„¶å›¾åƒåˆ†ç±» (32Ã—32å½©è‰²å›¾åƒï¼Œ10ç±»)
- **CIFAR-100**: ç»†ç²’åº¦å›¾åƒåˆ†ç±» (32Ã—32å½©è‰²å›¾åƒï¼Œ100ç±»)

### æ¨¡å‹æ¶æ„

- **MNIST**: CNN, ä¼˜åŒ–CNN, ä¼˜åŒ–CNN+GroupNorm, MLP
- **CIFAR-10**: CNN, ResNet18, ResNet18-Fed, EfficientNet
- **CIFAR-100**: CNN, ResNet18-Fed, EfficientNet, DenseNet
- **Fashion-MNIST**: CNN

## âš™ï¸ é‡è¦å‚æ•°è¯´æ˜

### è”é‚¦å­¦ä¹ æ ¸å¿ƒå‚æ•°

- `--epochs`: å…¨å±€è®­ç»ƒè½®æ•°
- `--num_users`: å‚ä¸è®­ç»ƒçš„å®¢æˆ·ç«¯æ€»æ•°
- `--frac`: æ¯è½®é€‰æ‹©çš„å®¢æˆ·ç«¯æ¯”ä¾‹
- `--local_ep`: å®¢æˆ·ç«¯æœ¬åœ°è®­ç»ƒè½®æ•°
- `--local_bs`: æœ¬åœ°æ‰¹é‡å¤§å°
- `--lr`: å­¦ä¹ ç‡

### æ•°æ®åˆ†å¸ƒè®¾ç½®

- `--iid`: IIDæ•°æ®åˆ†å¸ƒï¼ˆé»˜è®¤ï¼šFalseï¼‰
- `--unequal`: éç­‰é‡æ•°æ®åˆ†å¸ƒï¼ˆé»˜è®¤ï¼šFalseï¼‰

### æ®‹å·®å­¦ä¹ ç‰¹æœ‰å‚æ•°

- `--pretrain_epochs`: é¢„è®­ç»ƒè½®æ•°
- `--residual_type`: æ®‹å·®ç±»å‹ (basic/adaptive)
- `--residual_weight`: æ®‹å·®æƒé‡

## ğŸ“ˆ å®éªŒç»“æœå¯è§†åŒ–

è¿è¡Œå®éªŒåï¼Œä½¿ç”¨å¯è§†åŒ–å·¥å…·åˆ†æç»“æœï¼š

```bash
# å¯è§†åŒ–å•ä¸ªå®éªŒç»“æœ
python visualize_results.py path/to/log_file.csv --output_dir ./save/plots

# å¯¹æ¯”å¤šä¸ªå®éªŒç»“æœ  
python visualize_results.py --comparison --output_dir ./save/plots
```

ç”Ÿæˆçš„å›¾è¡¨åŒ…æ‹¬ï¼š

- è®­ç»ƒæŸå¤±æ›²çº¿
- æµ‹è¯•å‡†ç¡®ç‡æ›²çº¿
- å®¢æˆ·ç«¯æ€§èƒ½åˆ†å¸ƒ
- æ–¹æ³•å¯¹æ¯”åˆ†æ

## ğŸ”¬ å®éªŒè®¾è®¡è¯´æ˜

### æ¶ˆèç ”ç©¶æ€è·¯

ä½œä¸ºå­¦ç”Ÿï¼Œæˆ‘è®¾è®¡äº†ä»¥ä¸‹æ¶ˆèç ”ç©¶ï¼š

1. **åŸºçº¿å¯¹æ¯”**: é¦–å…ˆè¿è¡Œé›†ä¸­å¼è®­ç»ƒè·å¾—ç†æƒ³æ€§èƒ½ä¸Šç•Œ
2. **è”é‚¦å­¦ä¹ **: å®ç°ç»å…¸FedAvgç®—æ³•ï¼Œè§‚å¯Ÿå»ä¸­å¿ƒåŒ–å¸¦æ¥çš„æ€§èƒ½æŸå¤±
3. **æ®‹å·®å­¦ä¹ **: æå‡ºæ”¹è¿›æ–¹æ³•ï¼Œå°è¯•ç¼“è§£è”é‚¦å­¦ä¹ ä¸­çš„é—®é¢˜

### å…³é”®åˆ›æ–°ç‚¹

- **æ™ºèƒ½å®¢æˆ·ç«¯é€‰æ‹©**: åŸºäºå†å²è¡¨ç°åŠ¨æ€é€‰æ‹©å‚ä¸è®­ç»ƒçš„å®¢æˆ·ç«¯
- **è‡ªé€‚åº”èšåˆ**: æ ¹æ®å®¢æˆ·ç«¯æ•°æ®è´¨é‡è°ƒæ•´èšåˆæƒé‡
- **æ®‹å·®å­¦ä¹ æœºåˆ¶**: é€šè¿‡æ®‹å·®è¿æ¥æ”¹å–„æ”¶æ•›æ€§èƒ½
- **æ•°æ®å¢å¼ºç­–ç•¥**: å®ç°CutMixã€Mixupç­‰å¢å¼ºæŠ€æœ¯

è®­ç»ƒè¿‡ç¨‹ä¸­ä¼šè‡ªåŠ¨ä¿å­˜è¯¦ç»†æ—¥å¿—ï¼š

```save/logs/20251227_143000/
â”œâ”€â”€ experiment_config.json    # å®éªŒé…ç½®
â”œâ”€â”€ training_log.txt          # è¯¦ç»†è®­ç»ƒæ—¥å¿—  
â”œâ”€â”€ results_summary.csv       # ç»“æœæ±‡æ€»
â””â”€â”€ tensorboard_logs/         # TensorBoardæ—¥å¿—
```

è¿™æ˜¯æˆ‘åœ¨æœºå™¨å­¦ä¹ è¯¾ç¨‹ä¸­çš„å­¦ä¹ æˆæœï¼Œå¸Œæœ›èƒ½ä¸ºè”é‚¦å­¦ä¹ çš„ç ”ç©¶è´¡çŒ®ä¸€ä»½å¾®è–„ä¹‹åŠ›
